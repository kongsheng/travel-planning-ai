# 🚀 一键部署命令清单

## 📋 准备工作（只需做一次）

### 1. 安装必要工具
```bash
# 安装 Vercel CLI（可选，也可以用网页操作）
npm install -g vercel

# 安装 Git（如果还没有）
# Windows: https://git-scm.com/download/win
# Mac: brew install git
```

### 2. 初始化 Git 仓库
```bash
# 在项目根目录执行
git init
git add .
git commit -m "Initial commit"

# 推送到 GitHub
# 1. 在 GitHub 创建新仓库
# 2. 复制仓库地址，然后执行：
git remote add origin https://github.com/你的用户名/travel-planning-ai.git
git branch -M main
git push -u origin main
```

---

## 🌐 方案A：Render + Vercel（免费，推荐）

### 第1步：部署后端到 Render

#### 方式1：网页操作（推荐）
1. 访问 https://render.com/
2. 用 GitHub 登录
3. 点击 "New +" → "Web Service"
4. 选择你的 GitHub 仓库
5. 配置：
   ```
   Name: travel-planning-backend
   Root Directory: backend
   Environment: Node
   Build Command: npm install
   Start Command: npm start
   ```
6. 添加环境变量：
   - `ZHIPU_API_KEY` = 你的智谱密钥
   - `PORT` = 3001
7. 选择 Free 计划，点击 "Create Web Service"
8. 复制生成的 URL（类似：https://travel-planning-backend.onrender.com）

#### 方式2：命令行（高级）
```bash
# 需要先安装 Render CLI
# 然后在 backend 目录执行
cd backend
render deploy
```

### 第2步：部署前端到 Vercel

1. 修改 `.env.production` 文件，填入你的 Render 后端地址：
   ```env
   VITE_BACKEND_URL=https://你的后端地址.onrender.com
   ```

2. 访问 https://vercel.com/
3. 用 GitHub 登录
4. 点击 "Add New Project"
5. 选择你的仓库
6. 配置：
   ```
   Framework Preset: Vite
   Build Command: npm run build
   Output Directory: dist
   ```
7. 添加环境变量：
   - `VITE_BACKEND_URL` = https://你的后端地址.onrender.com
8. 点击 "Deploy"

---

## 💻 方案B：自己的服务器（稳定，需付费）

### 腾讯云轻量服务器（¥50/年新用户）

#### 1. 购买服务器
- 访问：https://cloud.tencent.com/
- 选择"轻量应用服务器"
- 配置：1核2G，系统选 Ubuntu 20.04
- 购买后记录：公网IP、用户名、密码

#### 2. 连接服务器
```bash
# Windows 用 PowerShell
ssh ubuntu@你的服务器IP

# 或使用腾讯云网页控制台的"登录"按钮
```

#### 3. 安装环境
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装 Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 安装 PM2（进程管理器）
sudo npm install -g pm2

# 安装 Nginx（反向代理）
sudo apt install -y nginx

# 验证安装
node -v  # 应该显示 v18.x.x
npm -v
```

#### 4. 部署项目
```bash
# 克隆项目
cd /home/ubuntu
git clone https://github.com/你的用户名/travel-planning-ai.git
cd travel-planning-ai

# 部署后端
cd backend
npm install
pm2 start server.js --name travel-backend
pm2 save
pm2 startup  # 设置开机自启

# 返回上级目录，部署前端
cd ..
npm install
npm run build

# 将前端文件复制到 Nginx 目录
sudo rm -rf /var/www/html/*
sudo cp -r dist/* /var/www/html/
```

#### 5. 配置 Nginx
```bash
sudo nano /etc/nginx/sites-available/default
```

替换内容为：
```nginx
server {
    listen 80;
    server_name _;

    # 前端静态文件
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }

    # 后端API代理
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

保存后重启 Nginx：
```bash
sudo nginx -t  # 测试配置
sudo systemctl restart nginx
```

#### 6. 配置防火墙
```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

#### 7. 测试访问
浏览器打开：http://你的服务器IP

---

## 🔄 后续更新部署

### Vercel（自动部署）
```bash
# 只需推送到 GitHub，Vercel 会自动部署
git add .
git commit -m "更新功能"
git push
```

### Render（自动部署）
```bash
# 推送到 GitHub，Render 会自动重新部署
git push
```

### 自己的服务器（手动部署）
```bash
# SSH 登录服务器
ssh ubuntu@你的服务器IP

# 拉取最新代码
cd /home/ubuntu/travel-planning-ai
git pull

# 更新后端
cd backend
npm install
pm2 restart travel-backend

# 更新前端
cd ..
npm install
npm run build
sudo cp -r dist/* /var/www/html/
```

---

## 🎯 推荐选择

| 场景 | 推荐方案 | 原因 |
|------|---------|------|
| **测试阶段** | Render + Vercel | 完全免费，够用 |
| **正式运营** | 腾讯云服务器 | 稳定，不休眠 |
| **高并发** | 阿里云/腾讯云 + CDN | 性能最好 |

---

## ⚠️ 常见问题

### Q: Render 后端休眠怎么办？
A: 使用 https://cron-job.org/ 每10分钟请求一次你的后端健康检查接口：
```
URL: https://你的后端.onrender.com/api/health
间隔: */10 * * * *（每10分钟）
```

### Q: Vercel 部署失败？
A: 检查：
1. `package.json` 中的 scripts 是否有 `"build": "vite build"`
2. Node.js 版本是否 >= 16
3. 环境变量是否正确设置

### Q: 服务器无法访问？
A: 检查：
1. 防火墙是否开放 80 端口
2. Nginx 是否正常运行：`sudo systemctl status nginx`
3. 后端是否正常运行：`pm2 status`

---

## 📞 需要帮助？

把错误信息和执行的命令发给我，我会帮你解决！

**祝你部署顺利！🎉**
