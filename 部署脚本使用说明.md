# ðŸš€ éƒ¨ç½²è„šæœ¬æ‰§è¡Œæ­¥éª¤

## å½“å‰çŠ¶æ€ï¼šæ­£åœ¨ä¸‹è½½éƒ¨ç½²è„šæœ¬ âœ…

ç­‰å¾…ä¸‹è½½å®ŒæˆåŽï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. æ£€æŸ¥è„šæœ¬æ˜¯å¦ä¸‹è½½æˆåŠŸ
ls -lh deploy.sh

# 2. æŸ¥çœ‹è„šæœ¬å†…å®¹ï¼ˆå¯é€‰ï¼Œç¡®è®¤è„šæœ¬æ­£ç¡®ï¼‰
cat deploy.sh | head -20

# 3. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# 4. è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy.sh
```

---

## âš ï¸ å¦‚æžœä¸‹è½½å¤±è´¥

å¦‚æžœçœ‹åˆ° "404: Not Found" æˆ–ä¸‹è½½è¶…æ—¶ï¼Œè¯´æ˜Ž GitHub ä»“åº“ä¸­è¿˜æ²¡æœ‰è¿™ä¸ªè„šæœ¬ã€‚

**è§£å†³æ–¹æ³•ï¼šæ‰‹åŠ¨åˆ›å»ºè„šæœ¬**

```bash
# 1. åˆ›å»ºè„šæœ¬æ–‡ä»¶
nano deploy.sh

# 2. å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°ç¼–è¾‘å™¨ä¸­
```

ç„¶åŽæŠŠä¸‹é¢çš„å®Œæ•´è„šæœ¬å†…å®¹å¤åˆ¶è¿›åŽ»ï¼š

```bash
#!/bin/bash

# ðŸš€ è…¾è®¯äº‘æœåŠ¡å™¨ä¸€é”®éƒ¨ç½²è„šæœ¬
set -e

echo "=========================================="
echo "ðŸš€ å¼€å§‹éƒ¨ç½²æ—…æ¸¸è§„åˆ’AIé¡¹ç›®"
echo "=========================================="

# 1. æ›´æ–°ç³»ç»Ÿ
echo ""
echo "ðŸ“¦ ç¬¬1æ­¥ï¼šæ›´æ–°ç³»ç»ŸåŒ…..."
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£… Node.js 18
echo ""
echo "ðŸ“¦ ç¬¬2æ­¥ï¼šå®‰è£… Node.js 18..."
if ! command -v node &> /dev/null; then
    curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
    sudo apt install -y nodejs
    echo "âœ… Node.js å®‰è£…æˆåŠŸï¼š$(node -v)"
else
    echo "âœ… Node.js å·²å®‰è£…ï¼š$(node -v)"
fi

# 3. å®‰è£… PM2
echo ""
echo "ðŸ“¦ ç¬¬3æ­¥ï¼šå®‰è£… PM2 è¿›ç¨‹ç®¡ç†å™¨..."
if ! command -v pm2 &> /dev/null; then
    sudo npm install -g pm2
    echo "âœ… PM2 å®‰è£…æˆåŠŸ"
else
    echo "âœ… PM2 å·²å®‰è£…"
fi

# 4. å®‰è£… Nginx
echo ""
echo "ðŸ“¦ ç¬¬4æ­¥ï¼šå®‰è£… Nginx..."
if ! command -v nginx &> /dev/null; then
    sudo apt install -y nginx
    echo "âœ… Nginx å®‰è£…æˆåŠŸ"
else
    echo "âœ… Nginx å·²å®‰è£…"
fi

# 5. å®‰è£… Git
echo ""
echo "ðŸ“¦ ç¬¬5æ­¥ï¼šæ£€æŸ¥ Git..."
if ! command -v git &> /dev/null; then
    sudo apt install -y git
    echo "âœ… Git å®‰è£…æˆåŠŸ"
else
    echo "âœ… Git å·²å®‰è£…"
fi

# 6. å…‹éš†é¡¹ç›®
echo ""
echo "ðŸ“¦ ç¬¬6æ­¥ï¼šèŽ·å–é¡¹ç›®ä»£ç ..."
cd ~
PROJECT_DIR="travel-planning-ai"

if [ -d "$PROJECT_DIR" ]; then
    echo "âš ï¸  é¡¹ç›®å·²å­˜åœ¨ï¼Œæ­£åœ¨æ›´æ–°..."
    cd $PROJECT_DIR
    git pull
else
    echo "ðŸ“¥ æ­£åœ¨å…‹éš†é¡¹ç›®..."
    git clone https://github.com/kongsheng/travel-planning-ai.git
    cd $PROJECT_DIR
fi

# 7. é…ç½®åŽç«¯çŽ¯å¢ƒå˜é‡
echo ""
echo "ðŸ“¦ ç¬¬7æ­¥ï¼šé…ç½®åŽç«¯çŽ¯å¢ƒå˜é‡..."
cd backend

if [ ! -f ".env" ]; then
    echo "âš ï¸  åˆ›å»º .env æ–‡ä»¶..."
    cat > .env << 'EOF'
# æ™ºè°±æ¸…è¨€ API
ZHIPU_API_KEY=ä½ çš„æ™ºè°±APIå¯†é’¥
ZHIPU_API_URL=https://open.bigmodel.cn/api/paas/v4/chat/completions

# Pexels å›¾ç‰‡ APIï¼ˆå¯é€‰ï¼‰
PEXELS_API_KEY=

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=production
EOF
    echo "â— è¯·ç¼–è¾‘ ~/travel-planning-ai/backend/.env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Keyï¼"
    echo "   æ‰§è¡Œå‘½ä»¤ï¼šnano ~/travel-planning-ai/backend/.env"
    read -p "æŒ‰ Enter ç»§ç»­..."
else
    echo "âœ… .env æ–‡ä»¶å·²å­˜åœ¨"
fi

# 8. å®‰è£…åŽç«¯ä¾èµ–
echo ""
echo "ðŸ“¦ ç¬¬8æ­¥ï¼šå®‰è£…åŽç«¯ä¾èµ–..."
npm install --production

# 9. å¯åŠ¨åŽç«¯æœåŠ¡
echo ""
echo "ðŸ“¦ ç¬¬9æ­¥ï¼šå¯åŠ¨åŽç«¯æœåŠ¡..."
pm2 stop travel-backend 2>/dev/null || true
pm2 delete travel-backend 2>/dev/null || true
pm2 start server.js --name travel-backend
pm2 save
sudo pm2 startup systemd -u ubuntu --hp /home/ubuntu
echo "âœ… åŽç«¯æœåŠ¡å·²å¯åŠ¨"

# 10. æž„å»ºå‰ç«¯
echo ""
echo "ðŸ“¦ ç¬¬10æ­¥ï¼šæž„å»ºå‰ç«¯..."
cd ..

cat > .env.production << 'EOF'
VITE_BACKEND_URL=http://localhost:3001
EOF

npm install
npm run build

# 11. éƒ¨ç½²å‰ç«¯åˆ° Nginx
echo ""
echo "ðŸ“¦ ç¬¬11æ­¥ï¼šéƒ¨ç½²å‰ç«¯åˆ° Nginx..."
sudo rm -rf /var/www/html/*
sudo cp -r dist/* /var/www/html/
echo "âœ… å‰ç«¯æ–‡ä»¶å·²å¤åˆ¶åˆ° Nginx"

# 12. é…ç½® Nginx
echo ""
echo "ðŸ“¦ ç¬¬12æ­¥ï¼šé…ç½® Nginx..."
sudo tee /etc/nginx/sites-available/default > /dev/null << 'EOF'
server {
    listen 80;
    server_name _;

    location / {
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }

    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
}
EOF

sudo nginx -t

if [ $? -eq 0 ]; then
    sudo systemctl restart nginx
    echo "âœ… Nginx é…ç½®æˆåŠŸå¹¶å·²é‡å¯"
else
    echo "âŒ Nginx é…ç½®æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥"
    exit 1
fi

# 13. é…ç½®é˜²ç«å¢™
echo ""
echo "ðŸ“¦ ç¬¬13æ­¥ï¼šé…ç½®é˜²ç«å¢™..."
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw --force enable
echo "âœ… é˜²ç«å¢™é…ç½®å®Œæˆ"

# 14. æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€
echo ""
echo "=========================================="
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
echo ""
echo "ðŸ“Š æœåŠ¡çŠ¶æ€ï¼š"
pm2 status
echo ""
echo "ðŸŒ è®¿é—®åœ°å€ï¼š"
echo "   http://$(curl -s ifconfig.me)"
echo ""
echo "ðŸ“ å¸¸ç”¨å‘½ä»¤ï¼š"
echo "   æŸ¥çœ‹åŽç«¯æ—¥å¿—ï¼špm2 logs travel-backend"
echo "   é‡å¯åŽç«¯ï¼špm2 restart travel-backend"
echo "   æŸ¥çœ‹ Nginx çŠ¶æ€ï¼šsudo systemctl status nginx"
echo "   é‡å¯ Nginxï¼šsudo systemctl restart nginx"
echo ""
echo "âš ï¸  é‡è¦æé†’ï¼š"
echo "   1. è®°å¾—ä¿®æ”¹ backend/.env æ–‡ä»¶ä¸­çš„ API Key"
echo "   2. æ‰§è¡Œå‘½ä»¤ï¼šnano ~/travel-planning-ai/backend/.env"
echo ""
echo "ðŸŽ‰ å¼€å§‹ä½¿ç”¨ä½ çš„æ—…æ¸¸è§„åˆ’AIå§ï¼"
echo "=========================================="
```

ä¿å­˜æ–¹æ³•ï¼š
- æŒ‰ `Ctrl + O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl + X` é€€å‡º

ç„¶åŽæ‰§è¡Œï¼š
```bash
chmod +x deploy.sh
bash deploy.sh
```

---

## ðŸ“ è„šæœ¬ä¼šè‡ªåŠ¨åšä»€ä¹ˆ

1. âœ… æ›´æ–°ç³»ç»Ÿ
2. âœ… å®‰è£… Node.js 18
3. âœ… å®‰è£… PM2
4. âœ… å®‰è£… Nginx
5. âœ… å…‹éš†ä½ çš„ GitHub é¡¹ç›®
6. âœ… åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆéœ€è¦ä½ å¡«å…¥ API Keyï¼‰
7. âœ… å®‰è£…æ‰€æœ‰ä¾èµ–
8. âœ… å¯åŠ¨åŽç«¯æœåŠ¡
9. âœ… æž„å»ºå‰ç«¯
10. âœ… é…ç½® Nginx
11. âœ… é…ç½®é˜²ç«å¢™

---

## âš ï¸ ä¸­é€”éœ€è¦ä½ åšçš„

è„šæœ¬è¿è¡Œåˆ°ç¬¬7æ­¥æ—¶ï¼Œä¼šæç¤ºä½ ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
nano ~/travel-planning-ai/backend/.env
```

æ‰¾åˆ°è¿™ä¸€è¡Œï¼š
```
ZHIPU_API_KEY=ä½ çš„æ™ºè°±APIå¯†é’¥
```

æ”¹æˆä½ çš„çœŸå®ž API Keyï¼š
```
ZHIPU_API_KEY=ä½ çš„å®žé™…å¯†é’¥
```

ä¿å­˜å¹¶é€€å‡ºï¼Œç„¶åŽæŒ‰ Enter ç»§ç»­ã€‚

---

## ðŸŽ‰ å®ŒæˆåŽ

æµè§ˆå™¨è®¿é—®ï¼šhttp://49.235.101.226

æµ‹è¯•ç”Ÿæˆè¡Œç¨‹ï¼
